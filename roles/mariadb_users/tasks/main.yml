---
- name: "Run with python 2 as root"
  become: yes
  vars:
    ansible_python_interpreter: "{{ ansible_python2_interpreter }}"
  block:
    - name: Remove anonymous users
      mysql_user:
        name: ''
        host_all: true
        login_user: root
        state: absent
      no_log: true

    - name: Create the users
      mysql_user:
        name: "{{ item.name }}"
        password: "{{ item.password }}"
        host: "{{ item.host|default('localhost') }}"
        priv: "{{ item.priv }}"
        append_privs: "{{ item.append_privs|default('no') }}"
        login_user: root
        state: present
      no_log: true
      with_items: "{{ mariadb_users }}"
